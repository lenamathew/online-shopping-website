<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop - ShopEase (Fixed)</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Material Design Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Bootstrap Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="home.html">
                <span class="material-icons align-middle">shopping_bag</span>
                ShopEase
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="home.html">
                            <span class="material-icons align-middle">home</span> Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="shop.html">
                            <span class="material-icons align-middle">store</span> Shop
                        </a>
                    </li>
                    <li class="nav-item" id="adminLink" style="display: none;">
                        <a class="nav-link" href="add-product.html">
                            <span class="material-icons align-middle">add_box</span> Add Product
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="cart.html">
                            <span class="material-icons align-middle">shopping_cart</span> 
                            Cart (<span id="cartCount">0</span>)
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="logoutBtn">
                            <span class="material-icons align-middle">logout</span> Logout
                        </a>
                    </li>
                </ul>
                <span class="navbar-text ms-3" id="userGreeting"></span>
            </div>
        </div>
    </nav>
    
    <!-- Hero Section -->
    <section class="bg-light py-5">
        <div class="container text-center">
            <h1 class="display-4 fw-bold text-primary mb-3">
                <span class="material-icons align-middle" style="font-size: 3rem;">store</span>
                Our Products
            </h1>
            <p class="text-center text-muted">Browse our amazing collection</p>
        </div>
    </section>
    
    <!-- Products Section -->
    <section class="py-5">
        <div class="container">
            <!-- Search and Filter -->
            <div class="row mb-4">
                <div class="col-md-6 mb-3">
                    <div class="input-group">
                        <span class="input-group-text"><span class="material-icons">search</span></span>
                        <input type="text" class="form-control" id="searchInput" placeholder="Search products...">
                    </div>
                </div>
                <div class="col-md-6 mb-3 text-end">
                    <span id="productCount" class="text-muted"></span>
                </div>
            </div>
            
            <!-- Alert for empty products -->
            <div id="emptyMessage" class="alert alert-info text-center d-none">
                <span class="material-icons" style="font-size: 48px;">inventory_2</span>
                <h4 class="mt-3">No products available</h4>
                <p>Check back later for new arrivals!</p>
            </div>
            
            <!-- Products Grid -->
            <div id="productsContainer" class="row g-4">
                <!-- Products will be dynamically loaded here -->
            </div>
            
            <!-- Debug Info -->
            <div id="debugInfo" class="mt-4 p-3 bg-light border rounded" style="display: none;">
                <h5>Debug Information:</h5>
                <p id="debugText"></p>
            </div>
        </div>
    </section>
    
    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0">&copy; 2025 ShopEase. All Rights Reserved.</p>
        </div>
    </footer>
    
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Embedded Product Management -->
    <script>
        // Product management functions (embedded to ensure they work)
        function initializeProducts() {
            const products = localStorage.getItem('products');
            console.log('Checking localStorage for products...', products ? 'Found' : 'Not found');
            
            if (!products) {
                const defaultProducts = [
                    {
                        id: 1,
                        name: 'Wireless Headphones',
                        description: 'Premium noise-cancelling wireless headphones with 30-hour battery life',
                        price: 129.99,
                        image: 'https://via.placeholder.com/300x200/6200ea/ffffff?text=Headphones'
                    },
                    {
                        id: 2,
                        name: 'Smart Watch',
                        description: 'Fitness tracking smartwatch with heart rate monitor and GPS',
                        price: 249.99,
                        image: 'https://via.placeholder.com/300x200/6200ea/ffffff?text=Smart+Watch'
                    },
                    {
                        id: 3,
                        name: 'Laptop Backpack',
                        description: 'Water-resistant backpack with USB charging port and multiple compartments',
                        price: 49.99,
                        image: 'https://via.placeholder.com/300x200/6200ea/ffffff?text=Backpack'
                    },
                    {
                        id: 4,
                        name: 'Bluetooth Speaker',
                        description: 'Portable wireless speaker with 360Â° sound and 12-hour battery',
                        price: 79.99,
                        image: 'https://via.placeholder.com/300x200/6200ea/ffffff?text=Speaker'
                    },
                    {
                        id: 5,
                        name: 'Wireless Mouse',
                        description: 'Ergonomic wireless mouse with precision tracking and long battery life',
                        price: 29.99,
                        image: 'https://via.placeholder.com/300x200/6200ea/ffffff?text=Mouse'
                    },
                    {
                        id: 6,
                        name: 'USB-C Hub',
                        description: 'Multi-port USB-C hub with HDMI, USB 3.0, and SD card reader',
                        price: 39.99,
                        image: 'https://via.placeholder.com/300x200/6200ea/ffffff?text=USB+Hub'
                    },
                    {
                        id: 7,
                        name: 'Phone Case',
                        description: 'Durable protective case with shock absorption and slim design',
                        price: 19.99,
                        image: 'https://via.placeholder.com/300x200/6200ea/ffffff?text=Phone+Case'
                    },
                    {
                        id: 8,
                        name: 'Desk Lamp',
                        description: 'LED desk lamp with adjustable brightness and color temperature',
                        price: 34.99,
                        image: 'https://via.placeholder.com/300x200/6200ea/ffffff?text=Desk+Lamp'
                    }
                ];
                localStorage.setItem('products', JSON.stringify(defaultProducts));
                console.log('Default products saved to localStorage');
            }
        }

        function getAllProducts() {
            const products = localStorage.getItem('products');
            return products ? JSON.parse(products) : [];
        }
        
        // Simple cart functions
        function addToCart(productId) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ id: productId, quantity: 1 });
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
        }
        
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            document.getElementById('cartCount').textContent = count;
        }
        
        // Main initialization
        let isAdmin = false;
        
        window.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing...');
            
            // Force initialize products
            initializeProducts();
            
            // Load and display products
            loadProducts();
            
            // Update cart count
            updateCartCount();
            
            // Set greeting
            document.getElementById('userGreeting').textContent = 'Welcome! Please login for full access';
            
            console.log('Initialization complete');
        });
        
        // Load and display products
        function loadProducts() {
            console.log('loadProducts() called');
            const products = getAllProducts();
            console.log('Products retrieved:', products);
            console.log('Number of products:', products.length);
            
            // Show debug info
            document.getElementById('debugInfo').style.display = 'block';
            document.getElementById('debugText').innerHTML = `
                LocalStorage products: ${localStorage.getItem('products') ? 'EXISTS' : 'NOT FOUND'}<br>
                Number of products: ${products.length}<br>
                First product: ${products[0] ? products[0].name : 'NONE'}
            `;
            
            const container = document.getElementById('productsContainer');
            const emptyMessage = document.getElementById('emptyMessage');
            const productCount = document.getElementById('productCount');
            
            if (products.length === 0) {
                console.log('No products found, showing empty message');
                emptyMessage.classList.remove('d-none');
                container.innerHTML = '';
                productCount.textContent = '';
                return;
            }
            
            console.log('Displaying', products.length, 'products');
            emptyMessage.classList.add('d-none');
            productCount.textContent = `Showing ${products.length} products`;
            
            container.innerHTML = '';
            
            products.forEach(product => {
                const productCard = createProductCard(product);
                container.appendChild(productCard);
            });
        }
        
        // Create product card
        function createProductCard(product) {
            const col = document.createElement('div');
            col.className = 'col-md-4 col-lg-3 col-sm-6';
            
            const imageUrl = product.image || `https://via.placeholder.com/300x200/6200ea/ffffff?text=${encodeURIComponent(product.name)}`;
            
            col.innerHTML = `
                <div class="card h-100 shadow-sm">
                    <img src="${imageUrl}" class="card-img-top" alt="${product.name}" 
                         onerror="this.src='https://via.placeholder.com/300x200/6200ea/ffffff?text=Product'">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">${product.name}</h5>
                        <p class="card-text text-muted flex-grow-1">${product.description}</p>
                        <h4 class="text-primary mb-3">$${product.price}</h4>
                        
                        <button class="btn btn-primary w-100" onclick="addToCartHandler(${product.id})">
                            <span class="material-icons align-middle">add_shopping_cart</span>
                            Add to Cart
                        </button>
                    </div>
                </div>
            `;
            
            return col;
        }
        
        // Add to cart handler
        function addToCartHandler(productId) {
            addToCart(productId);
            alert('Product added to cart!');
        }
        
        // Search functionality
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('searchInput').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const products = getAllProducts();
                const filtered = products.filter(p => 
                    p.name.toLowerCase().includes(searchTerm) || 
                    p.description.toLowerCase().includes(searchTerm)
                );
                
                displayFilteredProducts(filtered);
            });
        });
        
        function displayFilteredProducts(products) {
            const container = document.getElementById('productsContainer');
            container.innerHTML = '';
            
            products.forEach(product => {
                const productCard = createProductCard(product);
                container.appendChild(productCard);
            });
            
            document.getElementById('productCount').textContent = `Showing ${products.length} products`;
        }
    </script>
</body>
</html>